<!DOCTYPE HTML>
<html>
  <head>
    <!-- <script type="text/javascript" src="braille-paint.js"></script> -->
    <style>
      body {
        margin: 0px;
        padding: 0px;
      }

      span {
        font-size: 30px;
        font-weight: bold;
        line-height: 0.95;
        letter-spacing: -0.3em;
      }
    </style>
  </head>
  <body>
    <div>The content is...</div>
    <div id="braille-output">
      <div>
        <span id="0-0">&#x2803</span>
        <span id="0-2">&#x2803</span>
        <span id="0-4">&#x2803</span>
        <span id="0-6">&#x2803</span>
        <span id="0-8">&#x2803</span>
        <span id="0-10">&#x2803</span>
        <span id="0-12">&#x2803</span>
        <span id="0-14">&#x2803</span>
        <span id="0-16">&#x2803</span>
        <span id="0-18">&#x2803</span>
        <span id="0-20">&#x2803</span>
        <span id="0-22">&#x2803</span>
      </div>
      <div>
        <span id="4-0">&#x2803</span>
        <span id="4-2">&#x2803</span>
        <span id="4-4">&#x2803</span>
        <span id="4-6">&#x2803</span>
        <span id="4-8">&#x2803</span>
        <span id="4-10">&#x2803</span>
        <span id="4-12">&#x2803</span>
        <span id="4-14">&#x2803</span>
        <span id="4-16">&#x2803</span>
        <span id="4-18">&#x2803</span>
        <span id="4-20">&#x2803</span>
        <span id="4-22">&#x2803</span>
      </div>
      <div>
        <span id="8-0">&#x2803</span>
        <span id="8-2">&#x2803</span>
        <span id="8-4">&#x2803</span>
        <span id="8-6">&#x2803</span>
        <span id="8-8">&#x2803</span>
        <span id="8-10">&#x2803</span>
        <span id="8-12">&#x2803</span>
        <span id="8-14">&#x2803</span>
        <span id="8-16">&#x2803</span>
        <span id="8-18">&#x2803</span>
        <span id="8-20">&#x2803</span>
        <span id="8-22">&#x2803</span>
      </div>
      <div>
        <span id="12-0">&#x2803</span>
        <span id="12-2">&#x2803</span>
        <span id="12-4">&#x2803</span>
        <span id="12-6">&#x2803</span>
        <span id="12-8">&#x2803</span>
        <span id="12-10">&#x2803</span>
        <span id="12-12">&#x2803</span>
        <span id="12-14">&#x2803</span>
        <span id="12-16">&#x2803</span>
        <span id="12-18">&#x2803</span>
        <span id="12-20">&#x2803</span>
        <span id="12-22">&#x2803</span>
      </div>
      <div>
        <span id="16-0">&#x2803</span>
        <span id="16-2">&#x2803</span>
        <span id="16-4">&#x2803</span>
        <span id="16-6">&#x2803</span>
        <span id="16-8">&#x2803</span>
        <span id="16-10">&#x2803</span>
        <span id="16-12">&#x2803</span>
        <span id="16-14">&#x2803</span>
        <span id="16-16">&#x2803</span>
        <span id="16-18">&#x2803</span>
        <span id="16-20">&#x2803</span>
        <span id="16-22">&#x2803</span>
      </div>
      <div>
        <span id="20-0">&#x2803</span>
        <span id="20-2">&#x2803</span>
        <span id="20-4">&#x2803</span>
        <span id="20-6">&#x2803</span>
        <span id="20-8">&#x2803</span>
        <span id="20-10">&#x2803</span>
        <span id="20-12">&#x2803</span>
        <span id="20-14">&#x2803</span>
        <span id="20-16">&#x2803</span>
        <span id="20-18">&#x2803</span>
        <span id="20-20">&#x2803</span>
        <span id="20-22">&#x2803</span>
      </div>
      <div>
        <span id="24-0">&#x2803</span>
        <span id="24-2">&#x2803</span>
        <span id="24-4">&#x2803</span>
        <span id="24-6">&#x2803</span>
        <span id="24-8">&#x2803</span>
        <span id="24-10">&#x2803</span>
        <span id="24-12">&#x2803</span>
        <span id="24-14">&#x2803</span>
        <span id="24-16">&#x2803</span>
        <span id="24-18">&#x2803</span>
        <span id="24-20">&#x2803</span>
        <span id="24-22">&#x2803</span>
      </div>
      <div>
        <span id="28-0">&#x2803</span>
        <span id="28-2">&#x2803</span>
        <span id="28-4">&#x2803</span>
        <span id="28-6">&#x2803</span>
        <span id="28-8">&#x2803</span>
        <span id="28-10">&#x2803</span>
        <span id="28-12">&#x2803</span>
        <span id="28-14">&#x2803</span>
        <span id="28-16">&#x2803</span>
        <span id="28-18">&#x2803</span>
        <span id="28-20">&#x2803</span>
        <span id="28-22">&#x2803</span>
      </div>

    </div>
    <canvas id="myCanvas" width="578" height="400"></canvas>
    <script>
      function drawImage(imageObj) {
        var canvas = document.getElementById('myCanvas');
        var context = canvas.getContext('2d');
        var x = 69;
        var y = 50;

        context.drawImage(imageObj, x, y);

        var imageData = context.getImageData(x, y, imageObj.width, imageObj.height);
        var data = imageData.data;
        
        console.log(data);

        // var testSlice = sliceOnePixel(data, 0);
        // var testPixelColor = parseBlackWhite(testSlice);
        // var testIndexPosition = convertPixelPositionToIndexDataPosition(data, imageObj.height, imageObj.width, 7, 0);
        // var testBrailleData = buildBrailleCharacterData(data, imageObj.height, testIndexPosition);
        // var testConvertBrailleData = parseToBrailleCharacter(testBrailleData);
        // var testPrintBrailleData = printBrailleCode(testConvertBrailleData);


        fullTest();

        function fullTest()
        {
          for(var x=0;x<imageObj.width;x=x+2)//for(var x=0;x<=imageObj.height;x=x+2)
          {
            for(var y=0;y<=imageObj.height;y=y+4)
            {
              var testIndexPosition = convertPixelPositionToIndexDataPosition(data, imageObj.height, imageObj.width, y, x);
              var testBrailleData = buildBrailleCharacterData(data, imageObj.width, testIndexPosition);
              var testConvertBrailleData = parseToBrailleCharacter(testBrailleData);
              var brailleIdSelector = y + "-" + x;
              var testPrintBrailleData = printBrailleCode(brailleIdSelector, testConvertBrailleData);
            }
          } 
        }





        function sliceOnePixel(targetData, targetDataSlice_i)
        {
          var dataSlice = [];
          dataSlice.push(targetData[targetDataSlice_i])
          dataSlice.push(targetData[targetDataSlice_i + 1])
          dataSlice.push(targetData[targetDataSlice_i + 2]);
          console.log(dataSlice);
          return dataSlice;
        }

        function parseBlackWhite(targetData) // should be one pixel's worth
        {
          var blackOrWhitePixel;
          var r, g, b, rgbTotal;
          r = targetData[0];
          g = targetData[1];
          b = targetData[2];
          rgbTotal = r + b + g; 

          if(rgbTotal > 380)
          {
            blackOrWhitePixel = "0"; // white: no color, means no pin
          }
          else
          {
            blackOrWhitePixel = "1"; // black, gets pin
          }

          console.log(blackOrWhitePixel);
          return blackOrWhitePixel;
        }

        function convertPixelPositionToIndexDataPosition(targetImageData, targetImgHeight, targetImgWidth, pixelShiftTop, pixelShiftLeft)
        {
          var pixelIndex = (pixelShiftTop * targetImgWidth) + pixelShiftLeft;
          var indexPosition = pixelIndex * 4;
          return indexPosition;
        }

        function buildBrailleCharacterData(targetImageData, targetImgWidth, indexPosition)
        {
          var brailleCharacterData = [];
          var pinPositions = indexPosition;

          var pin1, pin1Data, pin2, pin2Data, pin3, pin3Data, pin4, pin4Data, pin5, pin5Data, pin6, pin6Data, pin7, pin7Data, pin8, pin8Data;

          pin1Data = sliceOnePixel(targetImageData, indexPosition);
          pin1 = parseBlackWhite(pin1Data);

          pin2Data = sliceOnePixel(targetImageData, indexPosition           + (1 * targetImgWidth * 4));
          pin2 = parseBlackWhite(pin2Data);

          pin3Data = sliceOnePixel(targetImageData, indexPosition           + (2 * targetImgWidth * 4));
          pin3 = parseBlackWhite(pin3Data);

          pin4Data = sliceOnePixel(targetImageData, indexPosition           + (3 * targetImgWidth * 4));
          pin4 = parseBlackWhite(pin4Data);

          pin5Data = sliceOnePixel(targetImageData, indexPosition + (1 * 4));
          pin5 = parseBlackWhite(pin5Data);
 
          pin6Data = sliceOnePixel(targetImageData, indexPosition + (1 * 4) + (1 * targetImgWidth * 4));
          pin6 = parseBlackWhite(pin6Data);
 
          pin7Data = sliceOnePixel(targetImageData, indexPosition + (1 * 4) + (2 * targetImgWidth * 4));
          pin7 = parseBlackWhite(pin7Data);
 
          pin8Data = sliceOnePixel(targetImageData, indexPosition + (1 * 4) + (3 * targetImgWidth * 4));
          pin8 = parseBlackWhite(pin8Data);

          console.log(pin1, pin2, pin3, pin4, pin5, pin6, pin7, pin8);
          brailleCharacterData = [pin1,pin2,pin3,pin4,pin5,pin6,pin7,pin8];
          return brailleCharacterData;

        }


        function parseToBrailleCharacter(targetBrailleCharacterData)
        {
          // The unicode designations for Braille characters follows an odd pattern,
          // but converts from Binary into Hex format for the unicode designation

          var pin = targetBrailleCharacterData;
          var hexNumValue;

          translatePinsToHex();

          function translatePinsToHex()
          {
            var brailleDataString = pin[7] + pin[3] + pin[6] + pin[5] + pin[4] + pin[2] + pin[1] + pin[0];
            // Convert binary to hexadecimal
            hexNumValue = parseInt(brailleDataString, 2).toString(16);
            hexNumValue = String(hexNumValue);
          }

          var testLength = hexNumValue.length;

          if(testLength == 1)
          {
            hexNumValue = "0" + hexNumValue;
          }
          return hexNumValue;
        }

        function printBrailleCode(selector, brailleUnicodeText)
        {
          var output = "&#x28" + brailleUnicodeText.toString();
          if(selector.length != 0 && selector != null)
          {
            var targetElement = document.getElementById(selector);
            if(targetElement.length != 0)
            {
              document.getElementById(selector).innerHTML = output;
            }
            
          }
          

        }

        // overwrite original image
        context.putImageData(imageData, x, y);
      }
      
      var imageObj = new Image();
      imageObj.onload = function() {
        drawImage(this);
      };

      imageObj.src = 'images/zen.png';
      // // imageObj.src = 'images/darth-vader.jpg';




    </script>
  </body>
</html>        